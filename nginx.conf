# Haruspex - Intel x86-64 ISA browser
#
# Usage:
#   1. Replace $ROOT with path to public/
#   2. Replace $DOMAIN with your domain
#   3. Link to /etc/nginx/sites-enabled/
#   4. Run: cd analysis && bun run generate

server {
    listen 80;
    server_name $DOMAIN;
    
    root $ROOT;
    
    gzip on;
    gzip_types application/json text/css application/javascript;
    
    location = / {
        try_files /index.html =404;
    }
    
    location /static/ {
        alias $ROOT/;
        expires 1d;
    }
    
    location = /datasets.json {
        add_header Content-Type application/json;
        try_files /datasets.json =404;
    }
    
    location ~ ^/chip/([^/]+)$ {
        return 301 $scheme://$host/chip/$1/grid/;
    }
    
    location ~ ^/chip/([^/]+)/list$ {
        try_files /list.html =404;
    }
    
    location ~ ^/chip/([^/]+)/grid(/.*)?$ {
        try_files /grid.html =404;
    }
    
    location / {
        return 301 /;
    }
}
